import os
import sqlite3
from db_utils import create_customer_table, insert_customer

# Sett opp logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

try:
    from db_utils import create_customer_table, insert_customer
except ImportError as e:
    logger.error(f"Error importing from db_utils: {e}")
    logger.info("Please make sure all required packages are installed.")
    logger.info("You can install them by running: pip install -r requirements.txt")
    exit(1)

def database_exists():
    return os.path.exists('customer.db')

def table_exists(table_name):
    conn = sqlite3.connect('customer.db')
    cursor = conn.cursor()
    cursor.execute(f"SELECT name FROM sqlite_master WHERE type='table' AND name='{table_name}';")
    result = cursor.fetchone()
    conn.close()
    return result is not None

def setup_database():
    if database_exists() and table_exists('customers'):
        print("Database og kundertabell eksisterer allerede.")
        overwrite = input("Vil du overskrive eksisterende data? (ja/nei): ").lower()
        if overwrite != 'ja':
            print("Avbryter oppsett. Eksisterende database beholdes.")
            return

    create_customer_table()

    insert_customer("142", 59.38784, 6.43636, "star_white", "Customer")
    insert_customer("145", 59.38838, 6.43878, "star_white", "Customer")
    insert_customer("149", 59.38873, 6.4379, "star_white", "Customer")
    insert_customer("156", 59.38858, 6.43593, "star_white", "Customer")
    insert_customer("158", 59.38874, 6.43545, "star_white", "Customer")
    insert_customer("160", 59.38746, 6.43432, "star_red", "Customer")
    insert_customer("162", 59.38782, 6.43434, "star_red", "Customer")
    insert_customer("164", 59.38815, 6.43446, "star_white", "Customer")
    insert_customer("168", 59.38869, 6.43403, "star_red", "Customer")
    insert_customer("169", 59.38923, 6.43379, "star_red", "Customer")
    insert_customer("173", 59.38947, 6.43444, "dot_white", "Customer")
    insert_customer("175", 59.38951, 6.4339, "star_white", "Customer")
    insert_customer("177", 59.38935, 6.4331, "star_white", "Customer")
    insert_customer("179", 59.38946, 6.43262, "star_red", "Customer")
    insert_customer("181", 59.38959, 6.43209, "dot_white", "Customer")
    insert_customer("183", 59.38972, 6.43174, "star_white", "Customer")
    insert_customer("184", 59.38909, 6.43204, "star_red", "Customer")
    insert_customer("185", 59.38977, 6.43126, "star_red", "Customer")
    insert_customer("187", 59.39004, 6.43096, "star_red", "Customer")
    insert_customer("189", 59.39031, 6.42992, "star_red", "Customer")
    insert_customer("191", 59.39052, 6.4295, "star_white", "Customer")
    insert_customer("193", 59.39051, 6.42887, "star_red", "Customer")
    insert_customer("195", 59.39023, 6.42911, "star_red", "Customer")
    insert_customer("197", 59.39008, 6.42945, "star_white", "Customer")
    insert_customer("199", 59.38992, 6.4298, "star_white", "Admin")
    insert_customer("214", 59.38697, 6.43167, "star_red", "Customer")
    insert_customer("216", 59.38688, 6.43094, "dot_white", "Customer")
    insert_customer("218", 59.38688, 6.43053, "star_red", "Customer")
    insert_customer("220", 59.38715, 6.43046, "star_white", "Customer")
    insert_customer("222", 59.38721, 6.4309, "star_white", "Customer")
    insert_customer("224", 59.38735, 6.4306, "star_red", "Customer")
    insert_customer("269", 59.39606, 6.42688, "star_red", "Customer")
    insert_customer("273", 59.3962348294344, 6.42662686469719, "star_red", "Customer")
    insert_customer("275", 59.3964730885728, 6.42652728934217, "star_red", "Customer")
    insert_customer("277", 59.3967366924767, 6.42637792630958, "star_white", "Customer")
    insert_customer("279", 59.3968127316832, 6.42565102621676, "star_red", "Customer")
    insert_customer("281", 59.3961638583032, 6.42577051664338, "star_red", "Customer")
    insert_customer("283", 59.3962500375147, 6.42498387133724, "star_white", "Customer")
    insert_customer("285", 59.39628, 6.42414, "dot_white", "Customer")
    insert_customer("287", 59.39629, 6.42337, "dot_white", "Customer")
    insert_customer("289", 59.39633, 6.42258, "dot_white", "Customer")
    insert_customer("295", 59.3948082452217, 6.4271906706364, "star_white", "Customer")
    insert_customer("297", 59.3945157339462, 6.42718050095621, "star_red", "Customer")
    insert_customer("299", 59.3941339803637, 6.42729685240294, "star_red", "Customer")
    insert_customer("300", 59.3940023402004, 6.42673448707452, "star_white", "Customer")
    insert_customer("302", 59.3936370360689, 6.42665691944364, "star_red", "Customer")
    insert_customer("304", 59.39333, 6.42651, "dot_white", "Customer")
    insert_customer("305", 59.3930545159307, 6.42691547821522, "star_white", "Customer")
    insert_customer("306", 59.3930446426217, 6.42637896876371, "star_red", "Customer")
    insert_customer("307", 59.39269, 6.42681, "dot_white", "Customer")
    insert_customer("1", 59.392314009777, 6.427270996526, "star_red", "Customer")
    insert_customer("1301", 59.3923107186026, 6.42672802310508, "dot_white", "Customer")
    insert_customer("1302", 59.39233, 6.427, "star_white", "Customer")
    insert_customer("1303", 59.39227, 6.4268, "dot_white", "Customer")
    insert_customer("1304", 59.39233, 6.42666, "star_white", "Customer")
    insert_customer("5", 59.392392997871, 6.42632725700977, "star_white", "Customer")
    insert_customer("7", 59.3925937584477, 6.42589417106711, "star_white", "Customer")
    insert_customer("9", 59.3926562901878, 6.4255063329098, "star_white", "Customer")
    insert_customer("13", 59.3928208468471, 6.42471126468683, "star_red", "Customer")
    insert_customer("14", 59.3904, 6.42631, "dot_white", "Customer")
    insert_customer("16", 59.3900704922271, 6.42643370664356, "star_white", "Customer")
    insert_customer("18", 59.3897520657748, 6.42650041119509, "star_white", "Customer")
    insert_customer("20", 59.3898836824044, 6.42715078056454, "star_white", "Customer")
    insert_customer("22", 59.3894888309828, 6.42702570953187, "star_red", "Customer")
    insert_customer("24", 59.38947, 6.42642, "star_red", "Customer")
    insert_customer("26", 59.3891365286081, 6.42615995620158, "star_red", "Customer")
    insert_customer("28", 59.3891227774171, 6.42662804687694, "star_white", "Customer")
    insert_customer("30", 59.3891502797936, 6.42722216196611, "star_white", "Customer")
    insert_customer("32", 59.38894, 6.42737, "dot_white", "Customer")
    insert_customer("34", 59.3889669301961, 6.42778027008051, "dot_white", "Customer")
    insert_customer("36", 59.3884031239716, 6.42755522648622, "star_white", "Customer")
    insert_customer("38", 59.388063918961, 6.42714114627241, "star_red", "Customer")
    insert_customer("40", 59.3883710371563, 6.42682608524037, "star_red", "Customer")
    insert_customer("42", 59.38864, 6.42654, "star_white", "Customer")
    insert_customer("44", 59.3887560769333, 6.42618696143233, "star_red", "Customer")
    insert_customer("46", 59.3897605571859, 6.42555820941481, "star_white", "Customer")
    insert_customer("48", 59.3899940701514, 6.42539144803791, "star_red", "Customer")
    insert_customer("51", 59.3920251266039, 6.42432252674419, "star_white", "Customer")
    insert_customer("53", 59.39236, 6.42384, "star_red", "Customer")
    insert_customer("55", 59.3925292553263, 6.42374840980923, "star_white", "Customer")
    insert_customer("57", 59.3928090022205, 6.42350924294524, "star_white", "Customer")
    insert_customer("59", 59.3927530530263, 6.42405221636613, "star_white", "Customer")
    insert_customer("61", 59.3931545687255, 6.42418149575189, "star_red", "Customer")
    insert_customer("63", 59.3932203905174, 6.42341228340592, "star_red", "Customer")
    insert_customer("65", 59.3936041255935, 6.42202225346096, "star_red", "Customer")
    insert_customer("67", 59.3932434281144, 6.42215827336332, "star_white", "Customer")
    insert_customer("68", 59.3919236776705, 6.42358034660756, "star_red", "Customer")
    insert_customer("69", 59.39235, 6.42251, "dot_white", "Customer")
    insert_customer("999", 0, 0, "admin", "Admin")
    insert_customer("1111", 0, 0, "admin", "Admin")
    insert_customer("1112", 0, 0, "admin", "Admin")
    insert_customer("1113", 0, 0, "admin", "Admin")
    insert_customer("1114", 0, 0, "admin", "Admin")
    insert_customer("1115", 0, 0, "admin", "Admin")

if __name__ == "__main__":
    setup_database()
    print("Database setup complete")